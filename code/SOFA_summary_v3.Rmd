---
params:
 rep_title: "Sea otter foraging analysis (SOFA) V. 3.*" 
 rep_subtitle: "(project and results filename)" 
 rep_date: "8/1/2024" 
 show.grptxt: FALSE
 GL1: 0
 GL2: 0
 GL3: 0
 GL4: 0
 GrpFgHt: 10
title: "`r params$rep_title`"
subtitle: "`r params$rep_subtitle`"
date: "`r params$rep_date`"
author: "SOFA created for U.S. Geological Survey and Seattle Aquarium by M.T. Tinker"
output:
  pdf_document: 
    latex_engine: pdflatex # xelatex 
    extra_dependencies: ["float"]
figsintext : yes    
header-includes:
- \usepackage{caption}
- \usepackage{longtable}
- \usepackage{titling}
- \pretitle{\begin{center}\LARGE\includegraphics[width=18cm]{SOFA_logo.png}\\[\bigskipamount]}
- \posttitle{\end{center}}  
editor_options:
  chunk_output_type: console
---

<div style="margin-bottom:50px;">

<style type="text/css">
.main-container {
  max-width: 1200px;
  margin-left: auto;
  margin-right: auto;
}
</style>

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.pos = "H", out.extra = "")

existing_Packages<-as.list(installed.packages()[,1])
# Add new packages you might need to this line, to check if they're installed and install missing packages
required_Packages<-c("rstan","ggplot2", "gridExtra", "bayesplot", "dplyr", "gtools", "knitr", "kableExtra")
missing_Packages<- required_Packages[!required_Packages%in% existing_Packages]
if(length(missing_Packages)>0)install.packages(pkgs =  missing_Packages, repos = "http://cran.us.r-project.org")
invisible(lapply(required_Packages, require, character.only=T,quietly = T))
rm(existing_Packages, missing_Packages, required_Packages)
#
# Load results file
load(file="Results.rdata")
# Set T/F key for Group option, use to determine whether to evaluate certain chunks
#  using ```{r, eval=Grp_TF} 
Grp_TF = GrpOpt==1
Nsamp = min(2500,Nsims)
r_mcmc = sample(Nsims,Nsamp,replace = F)
post = mcmc[r_mcmc,]

```

## Summary

The analytic approach is collectively referred to as the "Sea Otter Foraging Analysis", or SOFA. Standard variables recorded in the field from foraging sea otters - duration of dive and surface intervals, prey captures, prey sizes, etc. - are first summarized for all the dives in each feeding bout, and then Bayesian methods are used to fit a process model to these observed data, in order to estimate key "latent" parameters. Latent parameters of interest include how sea otters allocate their effort to foraging for different prey types, how much each of these prey types contributes to the resulting diet, several prey-specific parameters (mean size, handling time, capture rates, and the functional relationship between the latter two parameters and prey size), and the overall net rate of biomass consumption and energy intake. The process model uses a probabilistic approach to account for incomplete data (including un-identified prey and missing data fields from some records), and the inherent biases associated with incomplete data (e.g. which types and sizes of prey are more likely to be recorded as un-identified). The resulting parameter estimates account for all sources of uncertainty, including sampling error, measurement error, uncertainty in the functional relationship between prey size and edible biomass, error in caloric density estimates, and various other sources of parameter uncertainty.  

<div style="margin-bottom:50px;">
</div>

## Methods
### Observation model
SOFA is based around a simple conceptual model of sea otter foraging that corresponds to what an observer records in the field. Specifically, during a period of feeding activity (a “Bout”, consisting of a contiguous sequence of feeding dives), sea otters make decisions as to how to allocate their effort among multiple potential prey types. The term “prey type” is used here in a flexible way: a prey type may be a single species (*Tegula brunnea*), or it may be a group of related species (e.g. “marine snails”). Each prey type can be defined by several observable metrics including its capture rate (the number of items encountered and captured per minute of time searching for that prey during dives), the time required to handle an item of that prey type once captured, the size of each item and the correlations between prey size and the capture rate and per-item handling time. The size of each captured prey item is recorded in terms of the maximum linear dimension relative to paw size, for later conversion to an absolute value (*SZ*~j~, in mm). The total time in a bout allocated to each prey type *j* consists of the sum of the dive durations (*DT*~j~) for dives allocated to acquiring that prey type, and the sum of time at the surface spent handling items of that prey type (*HT*~j~), both of which are measured in seconds. For dives where multiple prey types are captured, we pro-rate the time among prey types: that is, the relevant *DT* and *HT* values are divided among prey types, proportional to their size and number.  In addition to the confirmed time allocated to each prey type, there is also “unallocated time” (*UT*) during a bout, which consists of the total duration of unsuccessful dives and time at surface (*ST*) not handing prey. We can partition this unallocated time among prey types according to their proportional contributions to confirmed allocated time, *PA*~j~.  Thus, the total number of minutes (*TM*) allocated to prey type *j* in bout *i* is calculated as:
$$T{{M}_{j,i}}~=\frac{1}{60}\left[ \sum{D{{T}_{j,i}}+}\sum{H{{T}_{j,i}}+}\left( P{{A}_{j,i}}\sum{UT_i} \right) \right]$$

We note that one of the prey types for which we calculate total allocated minutes consists of un-identified prey items (UNID): we assume that these UNID prey items are a collection of all the other known prey types, but we do not know *a priori* the proportion of each known prey type comprising the UNID category (these values are to be estimated by the model, as explained below).

For each observed bout we calculate the total number of minutes allocated to each prey type (*TM*~j,i~), and the mean value (averaged across dives) of four other statistics: the size of items of type j (*SZ.obs*~j,i~), the handling time per item of prey type j (*H.obs*~j,i~), the proportion of dives allocated to a prey type that are successful (*PSD*~j~), and the per-item capture rate during dives allocated to prey type j (*cp.obs*~j,i~). For the latter statistic we exclude handling time at the surface, thus ensuring that the capture rate statistic is equivalent to the *per-capita* attack rate parameter in type-II functional response models.

### Process model
The observed activity of sea otter foraging can be approximated by a sequence of mathematical equations that together represent the process model, the expected dynamics of which are determined by the values of the parameters in the equations (Table 1). We let $\eta_j$ represent the mean proportional allocation of foraging effort to prey type *j*, excluding the UNID class (i.e. TRUE effort allocation if all prey were positively identified), such that:
$$\sum_{j=1}^{J} \eta_j=1$$
  
For each prey type *j* we also specify parameter $\omega_j$ as the probability that an item of that prey type may not be positively identified. We calculate values of $\omega_j$ based on the empirical distributions of the log of handling time and the log of mean prey size of prey type *j*, and the degree to which these distributions overlap with the same distributions for the UNID prey class. We measure joint proportional overlap of multiple distributions using the Bhattacharyya distance metric (*BC*~j~), calculating $\omega_j$ as exp(-*BC*~j~). This approach reflects the assumption that the more similar the joint density distributions of size and handling time between UNID and prey type *j*, the more likely it is that *j* contributes to the UNID prey class. To account for unidentified prey in our observed data set, we define the parameter $\alpha$ as the relative allocation of effort to each prey type INCLUDING the UNID prey class. For positively identified prey types:
$${{\alpha }_{j}}={{\eta }_{j}}\cdot {(1  - {\omega }_{j})}\cdot \tau_B $$
while for the unidentified prey class (UNID):
$${{\alpha }_{u}}=\sum\limits_{j}{{{\eta }_{j}}\cdot {{\omega }_{j}} \cdot \tau_B }$$

In the above equations, parameter $\tau_B$ represents a fitted precision parameter, allowing us to use $\alpha_j$ as the base parameters for a Dirichlet distribution that defines the relative probabilities of a prey type being observed in a given bout:
$$\left[ {{\theta }_{j,i}} \right] \sim Dirichlet\left( {{\alpha }_{1}},{{\alpha }_{2}},\ ...\ {{\alpha }_{J}},{{\alpha }_{u}} \right)$$
where $\theta_{j,i}$ is the expected proportional allocation of effort to each prey type for bout *i*.

We define parameter $\mu_{s,j}$ as the mean log size (mm) for each prey type. For handling time and capture rate, we note that both of these parameters are correlated strongly with prey size: specifically, there is an approximately linear relationship between the log of each variable and the log of prey size.  We therefore calculate expected log handling time ($\mu_{h,j}$) and expected log capture rate ($\mu_{c,j}$) as derived parameters given the size of prey type j observed on a given bout:
$${{\mu }_{h,j}}={{\psi }_{1,j}}+{{\psi }_{2,j}}\cdot \log (SZ.obs_j)$$
$${{\mu }_{c,j}}={{\phi }_{1,j}}-{{\phi }_{2,j}}\cdot \log (SZ.obs_j)$$
where the fitted parameters $\phi_{1,j}$, $\phi_{2,j}$, $\psi_{1,j}$, and $\psi_{2,j}$, together describe the functional relationships between handling time, capture rate, and prey size for each prey type. We allow for variation in log size, log handling time and log capture rate across bouts by defining variance parameters $\sigma_{s,j}$, $\sigma_{h,j}$, and $\sigma_{c,j}$. We can also calculate mean parameter values averaged over all bouts: specifically, if we define ${\bar{\mu}}_{s,j}$ as the mean log size of prey type *j* over the entire data set, then we can calculate mean size, handling time and capture rate for prey type *j* as:
$${{{\bar{S}}}_{j}}=\exp \left( {{\bar{\mu}}_{s,j}}+{}^{\sigma _{s,j}^{2}}\!\!\diagup\!\!{}_{2}\; \right)$$
$${{{\bar{H}}}_{j}}=\exp \left( ({{\mu }_{h,j}}|{{\bar{\mu}}_{s,j}},{{\psi }_{j}})+{}^{\sigma _{h,j}^{2}}\!\!\diagup\!\!{}_{2}\; \right)$$
$${{\overline{cp}}_{j}}=\exp \left( ({{\mu }_{c,j}}|{{\bar{\mu}}_{s,j}},{{\phi }_{j}})+{}^{\sigma _{c,j}^{2}}\!\!\diagup\!\!{}_{2}\; \right)$$

We define parameter $\lambda_{j}$ the expected proportion of successful dives associated with each prey type, which we estimate as a logit parameter with Cauchy prior:
$$logit( \lambda_j ) \sim\ Cauchy\left( 0 , 2.5 \right)$$
And the overall mean dive success rate is calculated as:
$$\overline{\lambda } = {\sum\limits_{j=1}^{J}{{{\eta }_{j}}\cdot {{\overline{\lambda}}_{j}}}}\;$$

We next define several "derived" parameters that help simplify or expand our interpretation of model results. The biomass consumption rate for prey type *j* (*CR*~j~) during foraging time allocated to that prey type can be calculated using Hollings disc equation (i.e. the type-II function response equation): 
$$C{{R}_{j}}={}^{c{{p}_{j}}\cdot {{m}_{j}}}\!\!\diagup\!\!{}_{1+c{{p}_{j}}\cdot {{H}_{j}}}\;$$
where the per-item biomass of prey type *j* (*m*~j~) is calcuated from taxa-specific log-log relationships between maximum linear dimension (mm) and wet edible biomass (g), based on published data. We note that the handling time, capture rate and biomass values are all assumed to vary across bouts, corresponding to variation in prey size: we account for this source of uncertainty, as well as the uncertainty in the fitted mass-length relationships, by using a re-sampling approach in the calculation of *CR*~j~. We calculate the prey-specific energy intake rates in a similar way: 
$$E{{R}_{j}}={}^{c{{p}_{j}}\cdot {{m}_{j}}\cdot Cden{{s}_{j}}}\!\!\diagup\!\!{}_{1+c{{p}_{j}}\cdot {{H}_{j}}}\;$$
where *Cdens*~j~ is the caloric density (kcal/g) of items of prey type *j*, based on published data.

In addition to prey-specific parameters, we also integrate consumption rate and energy intake rates across all prey types, accounting for proportional allocation of effort among prey types, to obtain the overall consumption rate (CR) and energy intake rate (ER):
$$\overline {CR}  = \sum\limits_j {{\eta _j} \cdot C{R_j}} $$
$$\overline {ER}  = \sum\limits_j {{\eta _j} \cdot E{R_j}} $$
where $\eta_j$ represents the mean proportional allocation of foraging effort to prey type *j*, as defined above.

Diet composition, defined as the proportional contribution (in terms of consumed biomass) of each prey type to the overall diet ($/pi_j$), is calculated as: 
$${{\pi }_{j}}={\left( {{\eta }_{j}}\cdot {{\overline{cr}}_{j}} \right)}/{\sum\limits_{j=1}^{J}{{{\eta }_{j}}\cdot {{\overline{cr}}_{j}}}}\;$$
The proportional contribution of each prey type to the UNID prey class is represented by parameter $\upsilon_j$, calculated as:
$${{\upsilon }_{j}}={{\omega }_{j}} \cdot {{\pi }_{j}}\cdot {}^{1}\!\!\diagup\!\!{}_{E{{B}_{j}}}\;$$
where *EB*~j~ is the average biomass per prey item of prey type *j*. 

Finally, the process model can be modified to account for random effects of categorical group variables (age, sex, area, time period) by utilizing a hierarchical approach for certain key parameters.  We allow foraging effort to vary across groups using a Dirichlet-Multinomial approach:
$${{\eta }_{g,j}}\sim Dirichlet\left( {{\eta }_{j}}\cdot {{\tau }_{G}} \right)$$
where $\eta_{g,j}$ is the mean proportional allocation of foraging effort to prey type *j* in bouts belonging to group level *g*, and parameter $\tau_G$ is a fitted precision parameter that determines the degree of consistency in diet across groups. We assume that log prey size for each prey type is normally distributed across groups with mean equal to ${\bar{\mu}}_{s,j}$ and standard error as a fitted parameter. We make the same assumption for $\phi_{1,j}$, $\psi_{1,j}$ and $\lambda_{j}$, thereby allowing prey specific handling times, capture rates and dive success rates to vary across groups. By treating these base parameters hierarchically, we also allow for variation in the derived parameters of diet composition, mean consumption rates and mean energy intake rates across groups. Table 1 provides a summary of all parameters estimated by the model.

##### **Table 1. Summary of estimated parameters**
|Parameter | Description |
|:--------|---------|
| $\overline{CR}$ | Mean overall net biomass consumption rate (CR, g/min) while foraging |
| $\overline{ER}$ | Mean overall net energy intake rate (ER, kcal/min) while foraging |
| $\overline{\lambda }$ | Mean overall dive success rate (proportion successful dives)  |
| ${{\bar{S}}_{j}}$ | Mean size, prey type j |
| ${{\bar{H}}_{j}}$ | Mean handling time, prey type j |
| ${{\bar{cp}}_{j}}$ | Mean capture rate, prey type j |
| ${{\bar{CR}}_{j}}$ | Mean biomass consumtion rate, prey type j |
| ${{\bar{ER}}_{j}}$ | Mean energy intake rate, prey type j |
| ${{\bar{\lambda }}_{j}}$ | Mean dive success rate, prey type j |
| ${{\bar{\phi }}_{1,j}}$ | cp vs log(Size) function, intercept parameter, prey type j  |
| ${{\phi }_{2,j}}$ | cp vs log(Size) function, slope parameter, prey type j |
| ${{\bar{\psi }}_{1,j}}$ | H vs log(Size) function, intercept parameter, prey type j  |
| ${{\psi }_{2,j}}$ | H vs log(Size) function, slope parameter, prey type j |
| ${{\bar{\eta }}_{j}}$ | Proportion of foraging effort allocated to prey type j |
| ${{\bar{\pi }}_{j}}$ | Proportion of diet (biomass consumed) made up of prey type j |
| ${{\bar{\omega }}_{j}}$ | Proportion of prey type j identified (not recorded as "un-identified" prey) |
| ${{\bar{\upsilon }}_{j}}$ | Proportional contribution of prey type j to un-identified prey |
| $\sigma_{c,j}$ | Std error in log(CR) across bouts for a given prey type |
| $\sigma_{h,j}$ | Std error in log(H) across bouts for a given prey type |
| $\sigma_{s,j}$ | Std error in log(S) across bouts for a given prey type |
| $\sigma_{l,j}$ | Std error in logit(lambda) across bouts for a given prey type |
| ${{\tau }_{B}}$ | Precision (consistency) in diet composition across bouts (within group) |
| ${{\tau }_{G}}$ | Precision (consistency) in diet composition across groups (if defined)|
| ${{CR}_{g}}$ | Mean net consumption rate (CR, g/min) while foraging, group g |
| ${{ER}_{g}}$ | Mean net energy intake rate (ER, kcal/min) while foraging, group g |
| ${{\bar{\lambda} }_{g}}$ | Mean overall dive success rate, group g |
| ${{S}_{g,j}}$ | Mean size, prey type j, group g |
| ${{H}_{g,j}}$ | Mean handling time, prey type j, group g |
| ${{cp}_{g,j}}$ | Mean capture rate, prey type j, group g |
| ${{CR}_{g,j}}$ | Mean consumption rate, prey type j, group g |
| ${{ER}_{g,j}}$ | Mean energy intake rate, prey type j, group g |
| ${{\lambda }_{g,j}}$ | Mean dive success rate, prey type j, group g |
| ${{\phi }_{1,g,j}}$ | cp vs log(Size) function, intercept parameter, prey type j, group g |
| ${{\psi }_{1,g,j}}$ | H vs log(Size) function, intercept parameter, prey type j, group g |
| ${{\eta }_{g,j}}$ | Proportion of foraging effort allocated to prey type j, group g |
| ${{\pi }_{g,j}}$ | Proportion of diet (biomass consumed) made up of prey type j, group g |
| ${{\omega }_{g,j}}$ | Proportion of prey type j un-identified, group g |
| ${{\upsilon }_{g,j}}$ | Contribution of prey type j to un-identified prey, group g |
*Note: parameters with 'g' subscripts estimated if by-groups were incorporated in analysis*

### Relating observation model and process model
By comparing expected distributions from the process model with observed data, the statistics recorded from foraging bouts constrain the possible values of the parameters of the process model. Specifically, we assume that the observed distribution of minutes allocated to each prey type on a given bout can be described by a multinomial distribution:
$$\left[ T{{M}_{j,i}} \right]\sim Multinomial\left( \left[ {{\theta }_{j,i}} \right] \right)$$

We assume that observed mean prey size for prey type *j* on bout *i* is described by a log-normal distribution:
$$SZ.{{obs}_{j,i}}\sim\ lognormal\left( {{\mu }_{s,j}},{{\sigma }_{s,j}} \right)$$
where $\sigma_{s,j}$ is a parameter describing the variance in the mean size of prey *j* across bouts.  

We assume that observed mean handling time and mean capture rate for prey type *j* on bout *i* are also described by log-normal distributions:
$$H.{{obs}_{j,i}}\sim\ lognormal\left({{\psi }_{1,j}}+{{\psi }_{2,j}}\cdot \log (SZ.obs_{j,i}),{{\sigma }_{h,j}} \right)$$
$$cp.{{obs}_{j,i}}\sim\ lognormal\left( {{\phi }_{1,j}}-{{\phi }_{2,j}}\cdot \log (SZ.obs_{j,i}),{{\sigma }_{c,j}} \right)$$
where $\sigma_{h,j}$ and $\sigma_{c,j}$ are fitted parameters describing variance in these statistics across bouts.  

We assume that the observed dive success rates specific to each prey type (*PSD*~j~), logit-transformed, are described by a normal distribution: 
$$logit(PSD_j ) \sim\ normal\left( logit({{\lambda }_{j}}), {{\sigma }_{l,j}} \right)$$
where $\sigma_{l,j}$ is a fitted parameter describing variance in logit dive success rate across bouts.

We use standard Markov-Chain Monte Carlo methods to fit the model to the foraging data, with uninformative priors for all model parameters (Cauchy priors for unconstrained parameters and half-Cauchy priors for parameters constrained to be positive). We evaluate model convergence by graphically examining chain mixing and ensuring that the Rhat statistic is close to 1 for all estimated parameters. We evaluate model fit using graphical posterior predictive checks, ensuring that the distributions of out-of-sample predictions are consistent with observed data. We present summaries of posterior distributions for both base parameters and derived parameters such as biomass consumption and energy intake rate.

<div style="margin-bottom:50px;">
</div>

## Results
Both graphical and tabular results are presented below. In some cases prey types are referred to numerically (e.g. as subscripts for prey-specific parameters), in which case the numbers correspond to prey types as summarized in Table 2. 

```{r Table2, echo=FALSE}

kable(dfPtp, row.names = FALSE, format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Prey types included in the analysis") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

The posterior estimates for net consumption rate (CR) and energy intake rate (ER), for the data set as a whole, are shown in Figure 1, and summarized in Table 3. Posterior density plots are also shown for estimates of foraging effort allocation among prey types, proportional contribution to diet (in terms of consumed biomass) by prey type, and estimates mean handling time, size, consumption rate and energy intake rate for each prey type. 

If the SOFA analysis being summarized incorporated group-level differences in foraging behavior (e.g. area-based differences, time-based differences or differences among individual animals), a second series of plots are presented showing the same statistics described above but for each level of the grouping variable(s). `r if(params$show.grptxt){" See Table 2b"}`

```{r Table2b, echo=FALSE, eval=Grp_TF}

kable(Grouplist, row.names = FALSE, 
			format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Group levels used for by-group statitics") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

Tabular summaries of all statistics (both for all data combined and by group levels, if appropriate) are provided at the end of the report.

<div style="margin-bottom:50px;">
</div>

### Figures, statistics for ALL data 

```{r Fig1, echo=FALSE, warning=FALSE, fig.cap = "Density plot showing posterior distributions for consumption rate (${{\\bar{CR}}}$, g/min) and rate of energy intake (${{\\bar{ER}}}$, kcal/min) for the overall data set"}
plot_title = "Overall mean Consumption and Energy Intake Rate"
suppressMessages(print(
mcmc_areas(post,area_method = c("equal height"),
  pars = c("CRmn", "ERmn"),
  prob = 0.8) + ggtitle(plot_title,subtitle = paste0("Forage data ", Projectname)) +
	theme_classic() 
  # scale_x_continuous(name="Parameter value",limits=c(0,30))
))

```

```{r Fig2, echo=FALSE, warning=FALSE, fig.cap = "Density plot showing posterior distributions for $\\pi_j$, the proportion of diet (biomass consumed) made up of prey type j "}

plot_title = "Proportional contribution to diet (consumed biomass)"
suppressMessages(print(
mcmc_areas(post,area_method = c("equal height"),
  pars = paste0("Pi[",seq(1,(NPtypes-1)),"]"),
  prob = 0.8) + 
  scale_y_discrete(name="Diet Type",labels=dfPtp$PreyType) +
  ggtitle(plot_title,subtitle = paste0("Forage data ", Projectname)) +
	theme_classic() + theme(axis.text.y = element_text(angle = 45, hjust = 1, vjust=0))
))

```

```{r preyclass_calcs, echo=FALSE, include=FALSE}
Pclass = unique(dfPtp$Class[!is.na(dfPtp$Class)])
Nclasses = length(Pclass)
Pclass_stats = merge(dfPcl,data.frame(Prey_Class = Pclass),by.x = "Prey Class",by.y = "Prey_Class")
Pclass_stats = Pclass_stats[order(Pclass_stats$ClassN),]; colnames(Pclass_stats)[1] <- "Prey_Class"
Pclass_pi = numeric(length = Nclasses*Nsamp)
for( i in 1:Nclasses)	{
	cl = Pclass_stats$Prey_Class[i]
	ii = which(dfPtp$Class==cl)
	for(j in 1:length(ii)){
		prtp_n = dfPtp$TypeN[ii[j]]
		iiv = which(vn == paste0("Pi[",prtp_n,"]"))
		if(j==1){
			tmp = as.matrix(post[,iiv])
		}else{
			tmp = cbind(tmp,post[,iiv])
		}
	}
	Pclass_pi[((i-1)*Nsamp+1):((i-1)*Nsamp+Nsamp)] = apply(tmp,1,mean)
}
df_Pclass = data.frame(Prey_Class = rep(Pclass_stats$Prey_Class,each = Nsamp),
											 Pi = Pclass_pi)
df_Pclass$Prey_Class = factor(df_Pclass$Prey_Class,levels = Pclass_stats$Prey_Class)

stats = df_Pclass %>% group_by(Prey_Class) %>% 
	summarise(Pi_mean = mean(Pi), Pi_sd = sd(Pi),
						Pi_lo = quantile(Pi,0.025),Pi_hi = quantile(Pi,0.975))
Pclass_stats = merge(Pclass_stats,stats); 
Pclass_stats = Pclass_stats[order(Pclass_stats$ClassN),]

```

```{r Fig2b, echo=FALSE, warning=FALSE, fig.cap = "Boxplot showing posterior distributions for diet composition by Prey Class"}

plot_title = "Proportional contribution to diet (consumed biomass) by Prey Class"
plt_Cl_pi = ggplot(df_Pclass,aes(x=Prey_Class,y=Pi)) +
		geom_boxplot(fill="grey") +
		scale_x_discrete(name="Prey Class",labels=rev(Pclass_stats$Prey_Class),
										 limits = rev(levels(df_Pclass$Prey_Class))) +
		ggtitle(plot_title,subtitle = paste0("Forage data ", Projectname)) + 
	  coord_flip() + theme_classic() + theme(axis.text.y = element_text(angle = 45, hjust = 1, vjust=0))
print(plt_Cl_pi)	

```

```{r Fig3, echo=FALSE, warning=FALSE, fig.cap = "Caterpiller plot showing posterior distributions for $\\eta_j$, the relative allocation of effort to each prey type j"}

plot_title = "Proportional allocation of foraging effort"
suppressMessages(print(
mcmc_intervals(post,
               pars = paste0("eta[",seq(1,(NPtypes-1)),"]")) +
  scale_y_discrete(name="Diet Type",labels=dfPtp$PreyType) +
  ggtitle(plot_title,subtitle = paste0("Forage data ", Projectname)) +
	theme_classic() + theme(axis.text.y = element_text(angle = 45, hjust = 1, vjust=0))
))

```

```{r Fig4, echo=FALSE, warning=FALSE, fig.cap = "Caterpiller plot showing posterior distributions for the rate of energy intake while feeding on each prey type j"}

plot_title = "Rate of Energy Intake (kcal/min) by prey type"
suppressMessages(print(
mcmc_intervals(post,
               pars = paste0("ER[",seq(1,(NPtypes-1)),"]")) +
  scale_y_discrete(name="Diet Type",labels=dfPtp$PreyType) +
  ggtitle(plot_title,subtitle = paste0("Forage data ", Projectname)) +
	theme_classic() + theme(axis.text.y = element_text(angle = 45, hjust = 1, vjust=0))
))

```

```{r Fig5, echo=FALSE, warning=FALSE, fig.cap = "Caterpiller plot showing posterior distributions for $\\upsilon_j$, the relative contribution to un-identified of each prey type j "}

plot_title = "Proportional contribution of prey types to UNID prey"
suppressMessages(print(
mcmc_intervals(post,
               pars = paste0("upsilon[",seq(1,(NPtypes-1)),"]")) +
  scale_y_discrete(name="Diet Type",labels=dfPtp$PreyType) +
  ggtitle(plot_title,subtitle = paste0("Forage data ", Projectname)) +
	theme_classic() + theme(axis.text.y = element_text(angle = 45, hjust = 1, vjust=0))
))

```

<div style="margin-bottom:50px;">
</div>

`r if(params$show.grptxt){"### Figures, statistics by group level "}`

```{r Fig6, echo=FALSE, warning=FALSE, eval=Grp_TF, fig.cap = "Density plot showing posterior distributions for rate of energy intake (${{\\bar{ER}}_{g}}$, kcal/min) for each group level "}

  if(length(Grpvar)==1){
    Grpvartxt = Grpvar
  }else{
    Grpvartxt = paste(Grpvar, collapse = ', ')
  }

  plot_title = paste0("Posterior distributions, Energy Intake, by ", Grpvartxt)
  suppressMessages(print(
    mcmc_areas(post,
               pars = paste0("ERgmn[",seq(1,Ngrp),"]"),
               prob = 0.8) + ggtitle(plot_title,subtitle = paste0("Forage data ", Projectname))  
    + scale_y_discrete(name="Group",labels=Grouplist$Groupname) + theme_classic()
  ))

```

```{r Fig7, fig.height=GrpFgHt, echo=FALSE, warning=FALSE, eval=Grp_TF, fig.cap = "Caterpiller plots showing posterior distributions for $\\pi_{g,j}$, the proportion of diet (biomass consumed) made up of prey type j for group g "}

  if(length(Grpvar)==1){
    Grpvartxt = Grpvar
  }else{
    Grpvartxt = paste(Grpvar, collapse = ', ')
  }
  
  GL = numeric()
  if(params$GL1>0){GL = c(GL,params$GL1) }
  if(params$GL2>0){GL = c(GL,params$GL2) }
  if(params$GL3>0){GL = c(GL,params$GL3) }
  if(params$GL4>0){GL = c(GL,params$GL4) }

  plot_title = "Proportional contribution of prey to diet, by group"
  plts = list()
  for(g in 1:length(GL)){
    gl = GL[g]
    plts[[g]] = suppressMessages(mcmc_intervals(post,
               pars = paste0("PiG[",gl,",",seq(1,(NPtypes-1)),"]"),
               prob = 0.8) + 
      scale_y_discrete(name="Diet Type",labels=dfPtp$PreyType) +
      ggtitle(plot_title,subtitle = paste0("Group level ",Grouplist[gl,4])) + 
      theme_classic() + theme(axis.text.y = element_text(angle = 45, hjust = 1, vjust=0))
    )
  }
  grid.arrange(grobs=plts,ncol=1,nrow=length(GL))

```

```{r Fig8, fig.height=GrpFgHt, echo=FALSE, warning=FALSE, eval=Grp_TF, fig.cap = "Caterpiller plot showing posterior distributions for the rate of energy intake while feeding on each prey type j for group g "}

  if(length(Grpvar)==1){
    Grpvartxt = Grpvar
  }else{
    Grpvartxt = paste(Grpvar, collapse = ', ')
  }
  
  GL = numeric()
  if(params$GL1>0){GL = c(GL,params$GL1) }
  if(params$GL2>0){GL = c(GL,params$GL2) }
  if(params$GL3>0){GL = c(GL,params$GL3) }
  if(params$GL4>0){GL = c(GL,params$GL4) }

  plot_title = "Rate of Energy Intake by prey type, by group"
  
  plts = list()
  for(g in 1:length(GL)){
    gl = GL[g]
    plts[[g]] = suppressMessages(mcmc_intervals(post,
               pars = paste0("ERg[",gl,",",seq(1,(NPtypes-1)),"]"),
               prob = 0.8) + 
      scale_y_discrete(name="Diet Type",labels=dfPtp$PreyType) +
      ggtitle(plot_title,subtitle = paste0("Group level ",Grouplist[gl,4])) +
     	theme_classic() + theme(axis.text.y = element_text(angle = 45, hjust = 1, vjust=0))
    )
  }
  grid.arrange(grobs=plts,ncol=1,nrow=length(GL))

```

<div style="margin-bottom:50px;">
</div>

### Tables, statistics for ALL data 

```{r Table3, echo=FALSE}

ii = c(which(vns=="CRmn"), 
       which(vns=="ERmn"),
			 which(vns=="LMmn"))

paramstats = data.frame(Parameter = c("CR_bar","ER_bar","Lambda_bar"))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])
paramstats <- paramstats %>% mutate_if(is.numeric, signif, digits = 4)

kable(paramstats, row.names = FALSE, 
			format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Parameter estimates for consumption rate (${{\\bar{CR}}}$, g/min), rate of energy intake (${{\\bar{ER}}}$, kcal/min), and dive success rate ($\\bar{\\lambda}$) for the overall data set") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table4, echo=FALSE}

ii = c(which(startsWith(vns,"SZ[")))

paramstats = data.frame(Parameter = c(paste0("S_bar_",seq(1,(NPtypes-1))) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Parameter estimates for mean size, ${{\\bar{S}}_{j}}$ (mm), by prey type, for the overall data set") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace") 

```

```{r Table5, echo=FALSE}

ii = c(which(startsWith(vns,"HT[")))

paramstats = data.frame(Parameter = c(paste0("H_bar_",seq(1,(NPtypes-1))) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Parameter estimates for mean handling time, ${{\\bar{H}}_{j}}$ (sec), by prey type, for the overall data set") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table6, echo=FALSE}

ii = c(which(startsWith(vns,"CR[")))

paramstats = data.frame(Parameter = c(paste0("cr_",seq(1,(NPtypes-1))) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Parameter estimates for mean consumption rate by prey type ${{\\bar{cr}}_{j}}$ (g/min), for the overall data set") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table7, echo=FALSE}

ii = c(which(startsWith(vns,"ER[")))

paramstats = data.frame(Parameter = c(paste0("er_",seq(1,(NPtypes-1))) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Parameter estimates for mean energy intake rate by prey type ${{\\bar{er}}_{j}}$ (kcal/min), for the overall data set") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```


```{r Table8, echo=FALSE}

ii = c(which(startsWith(vns,"LM[")))

paramstats = data.frame(Parameter = c(paste0("lambda_",seq(1,(NPtypes-1))) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Parameter estimates for $\\lambda_j$, mean dive success rate by prey type, for the overall data set") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```


```{r Table9, echo=FALSE}

ii = c(which(startsWith(vns,"phi1[")))

paramstats = data.frame(Parameter = c(paste0("phi_1_",seq(1,(NPtypes-1))) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for $\\phi_{1,j}$, the intercept parameter for the function relating log consumption rate to log size, by prey type, for the overall data set") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table10, echo=FALSE}

ii = c(which(startsWith(vns,"phi2[")))

paramstats = data.frame(Parameter = c(paste0("phi_2_",seq(1,(NPtypes-1))) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for $\\phi_{2,j}$, the slope parameter for the function relating log consumption rate to log size, by prey type, for the overall data set") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table11, echo=FALSE}

ii = c(which(startsWith(vns,"psi1[")))

paramstats = data.frame(Parameter = c(paste0("psi_1_",seq(1,(NPtypes-1))) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for $\\psi_{1,j}$, the intercept parameter for the function relating log handling time to log size, by prey type, for the overall data set") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table12, echo=FALSE}

ii = c(which(startsWith(vns,"psi2[")))

paramstats = data.frame(Parameter = c(paste0("psi_2_",seq(1,(NPtypes-1))) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for $\\psi_{2,j}$, the slope parameter for the function relating log handling time to log size, by prey type, for the overall data set") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table13, echo=FALSE}

ii = c(which(startsWith(vns,"eta[")))

paramstats = data.frame(Parameter = c(paste0("eta_",seq(1,(NPtypes-1))) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for $\\eta_j$, proportional allocation of effort to prey type j, for the overall data set") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table14, echo=FALSE}

ii = c(which(startsWith(vns,"Pi[")))

paramstats = data.frame(Parameter = c(paste0("pi_",seq(1,(NPtypes-1))) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for $\\pi_j$, proportion of diet (consumed biomass) consisting of prey type j, for the overall data set") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table15, echo=FALSE}

ii = c(which(startsWith(vns,"Omega[")))

paramstats = data.frame(Parameter = c(paste0("omega_",seq(1,(NPtypes-1))) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

ii = c(which(startsWith(vns,"upsilon[")))
paramstats2 = data.frame(Parameter = c(paste0("upsilon_",seq(1,(NPtypes-1))) ))
paramstats2 = cbind(paramstats2,sumstats[ii,c(1,3,4,8,9,10)])

paramstats = rbind(paramstats,paramstats2)
	
kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for $\\omega_j$, probability that prey type j is positively identified (and thus not recorded as 'Un-ID' prey), and $\\upsilon_j$, relative contribution of each prey type to the UNID prey category.") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table16, echo=FALSE}

ii = c(which(startsWith(vns,"sigSZ[")), 
       which(startsWith(vns,"sigHT[")),
       which(startsWith(vns,"sigCR[")),
			 which(startsWith(vns,"sigLM[")),
       which(startsWith(vns,"tauB")),
       which(startsWith(vns,"tauG")))
if(Grp_TF){
  paramstats = data.frame(Parameter = c(paste0("sigma_s_",seq(1,(NPtypes-1))),
                                      paste0("sigma_h_",seq(1,(NPtypes-1))),
                                      paste0("sigma_c_",seq(1,(NPtypes-1))),
  																		paste0("sigma_l_",seq(1,(NPtypes-1))),
                                      paste0("tau_b_",seq(1,Ngrp)),
                                      "tau_g"))
}else{
  paramstats = data.frame(Parameter = c(paste0("sigma_s_",seq(1,(NPtypes-1))),
                                      paste0("sigma_h_",seq(1,(NPtypes-1))),
                                      paste0("sigma_c_",seq(1,(NPtypes-1))),
  																		paste0("sigma_l_",seq(1,(NPtypes-1))),
                                      "tau_b"))
}
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])
paramstats <- paramstats %>% mutate_if(is.numeric, signif, digits = 4)

kable(paramstats, row.names = FALSE, format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for model variance and precision parameters. Prey-specific standard error values are shown for log-normally distributed observed variables of prey size ($\\sigma_{s,j}$), handling time ($\\sigma_{h,j}$), consumption rate ($\\sigma_{c,j}$) and dive success rate ($\\sigma_{l,j}$). Also shown are precision parameters for Dirichlet distributions that describe the relative frequencies of different prey types. Precision parameters determine the consistency in diet composition across bouts ($\\tau_b$) and, if applicable, across different groups ($\\tau_g$)")  %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

<div style="margin-bottom:50px;">
</div>

`r if(params$show.grptxt){"### Tables, statistics by group level "}`

```{r Table17, eval=Grp_TF, echo=FALSE}

ii = c(which(startsWith(vns,"CRgmn[")), 
       which(startsWith(vns,"ERgmn[")),
			 which(startsWith(vns,"LMgmn[")))

paramstats = data.frame(Parameter = c(paste0("CR_",seq(1,Ngrp)),
                                      paste0("ER_",seq(1,Ngrp)),
																			paste0("Lambda_",seq(1,Ngrp)) ))

paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])
paramstats <- paramstats %>% mutate_if(is.numeric, signif, digits = 4)

kable(paramstats, row.names = FALSE, format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Parameter estimates for consumption rate (${{\\bar{CR}}_g}$, g/min), rate of energy intake (${{\\bar{ER}}_g}$, kcal/min) and dive success rate ($\\lambda_g$) for each group level g") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table18, eval=Grp_TF, echo=FALSE}

ii = numeric()
for(i in 1:Ngrp){
	for(j in 1:(NPtypes-1)){
		ii = c(ii,which(vns==paste0("SZg[",i,",",j,"]")))
	}
}

paramstats = data.frame(Parameter = c(paste0("S_", rep(seq(1,Ngrp),each=(NPtypes-1)), ",", rep(seq(1,(NPtypes-1)),Ngrp)) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Parameter estimates for mean size, ${{\\bar{S}}_{g,j}}$, by group level g and by prey type j") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table19, eval=Grp_TF, echo=FALSE}

ii = numeric()
for(i in 1:Ngrp){
	for(j in 1:(NPtypes-1)){
		ii = c(ii,which(vns==paste0("HTg[",i,",",j,"]")))
	}
}

paramstats = data.frame(Parameter = c(paste0("H_", rep(seq(1,Ngrp),each=(NPtypes-1)), ",", rep(seq(1,(NPtypes-1)),Ngrp)) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Parameter estimates for mean handling time, ${{\\bar{H}}_{g,j}}$, by group level g and by prey type j") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")
```

```{r Table20, eval=Grp_TF, echo=FALSE}

ii = numeric()
for(i in 1:Ngrp){
	for(j in 1:(NPtypes-1)){
		ii = c(ii,which(vns==paste0("CRg[",i,",",j,"]")))
	}
}

paramstats = data.frame(Parameter = c(paste0("cr_", rep(seq(1,Ngrp),each=(NPtypes-1)), ",", rep(seq(1,(NPtypes-1)),Ngrp)) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE, format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Parameter estimates for mean consumption rate, ${{\\bar{cr}}_{g,j}}$, by group level g and by prey type j") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table21, eval=Grp_TF, echo=FALSE}

ii = numeric()
for(i in 1:Ngrp){
	for(j in 1:(NPtypes-1)){
		ii = c(ii,which(vns==paste0("ERg[",i,",",j,"]")))
	}
}

paramstats = data.frame(Parameter = c(paste0("er_", rep(seq(1,Ngrp),each=(NPtypes-1)), ",", rep(seq(1,(NPtypes-1)),Ngrp)) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Parameter estimates for mean energy intake rate, ${{\\bar{er}}_{g,j}}$ (kcal/min), by group level g and by prey type j") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```


```{r Table22, eval=Grp_TF, echo=FALSE}

ii = numeric()
for(i in 1:Ngrp){
	for(j in 1:(NPtypes-1)){
		ii = c(ii,which(vns==paste0("LMg[",i,",",j,"]")))
	}
}

paramstats = data.frame(Parameter = c(paste0("lambda_",rep(seq(1,Ngrp),each=(NPtypes-1)), ",", rep(seq(1,(NPtypes-1)),Ngrp)) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Parameter estimates for $\\lambda_{g,j}$, mean dive success rate by group level g and by prey type j") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```


```{r Table23, eval=Grp_TF, echo=FALSE}

ii = numeric()
for(i in 1:Ngrp){
	for(j in 1:(NPtypes-1)){
		ii = c(ii,which(vns==paste0("phi1G[",i,",",j,"]")))
	}
}

paramstats = data.frame(Parameter = c(paste0("phi_1_", rep(seq(1,Ngrp),each=(NPtypes-1)), ",", rep(seq(1,(NPtypes-1)),Ngrp)) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for $\\phi_{1,g,j}$, intercept parameter for function relating log consumption rate to log size, for each group g and prey type j") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table24, eval=Grp_TF, echo=FALSE}

ii = numeric()
for(i in 1:Ngrp){
	for(j in 1:(NPtypes-1)){
		ii = c(ii,which(vns==paste0("psi1G[",i,",",j,"]")))
	}
}

paramstats = data.frame(Parameter = c(paste0("psi_1_", rep(seq(1,Ngrp),each=(NPtypes-1)), ",", rep(seq(1,(NPtypes-1)),Ngrp)) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for $\\psi_{1,g,j}$, intercept parameter for function relating log handling time to log size, for each group g and prey type j") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table25, eval=Grp_TF, echo=FALSE}

ii = numeric()
for(i in 1:Ngrp){
	for(j in 1:(NPtypes-1)){
		ii = c(ii,which(vns==paste0("etaG[",i,",",j,"]")))
	}
}

paramstats = data.frame(Parameter = c(paste0("eta_", rep(seq(1,Ngrp),each=(NPtypes-1)), ",", rep(seq(1,(NPtypes-1)),Ngrp)) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE, format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for $\\eta_{g,j}$, proportional allocation of effort to prey type j, for each group level g") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table26, eval=Grp_TF, echo=FALSE}

ii = numeric()
for(i in 1:Ngrp){
	for(j in 1:(NPtypes-1)){
		ii = c(ii,which(vns==paste0("PiG[",i,",",j,"]")))
	}
}

paramstats = data.frame(Parameter = c(paste0("pi_", rep(seq(1,Ngrp),each=(NPtypes-1)), ",", rep(seq(1,(NPtypes-1)),Ngrp)) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for $\\pi_{g,j}$, proportion of diet (consumed biomass) consisting of prey type j, for each group level g") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```

```{r Table27, eval=Grp_TF, echo=FALSE}

ii = numeric()
for(i in 1:Ngrp){
	for(j in 1:(NPtypes-1)){
		ii = c(ii,which(vns==paste0("OmegaG[",i,",",j,"]")))
	}
}

paramstats = data.frame(Parameter = c(paste0("omega_", rep(seq(1,Ngrp),each=(NPtypes-1)), ",", rep(seq(1,(NPtypes-1)),Ngrp)) ))
paramstats = cbind(paramstats,sumstats[ii,c(1,3,4,8,9,10)])

ii = numeric()
for(i in 1:Ngrp){
	for(j in 1:(NPtypes-1)){
		ii = c(ii,which(vns==paste0("upsilonG[",i,",",j,"]")))
	}
}

paramstats2 = data.frame(Parameter = c(paste0("upsilon_", rep(seq(1,Ngrp),each=(NPtypes-1)), ",", rep(seq(1,(NPtypes-1)),Ngrp)) ))
paramstats2 = cbind(paramstats2,sumstats[ii,c(1,3,4,8,9,10)])

paramstats = rbind(paramstats,paramstats2)

kable(paramstats, row.names = FALSE,format = "latex", centering = FALSE,booktabs = TRUE,longtable = TRUE,
      caption = "Estimates for $\\omega_{g,j}$, probability that prey type j is positively identified (and thus not recorded as 'Un-ID' prey) for each group level g, and $\\upsilon_{g,j}$, relative contribution of prey type j to 'Un-ID' prey category for each group level g") %>%
  kable_styling(latex_options = "repeat_header", repeat_header_text = "(continued)", repeat_header_method = "replace")

```


